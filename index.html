<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kid Chore Tracker</title>

<!-- Tailwind CDN (fine for a personal project) -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* â”€â”€ roulette wheel design â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#wheel{width:260px;height:260px;border-radius:50%;border:8px solid #444;position:relative;margin:auto}
.slice{position:absolute;width:50%;height:50%;transform-origin:100% 100%;clip-path:polygon(0 0,100% 0,100% 100%)}
.slice span{position:absolute;top:35%;left:55%;transform:translate(-50%,-50%) rotateZ(-90deg);font-size:.8rem;font-weight:bold;white-space:nowrap}
#pointer{width:0;height:0;border-left:15px solid transparent;border-right:15px solid transparent;border-bottom:25px solid #e11d48;margin:auto}
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(3600deg)}}
</style>
</head>

<body class="bg-gray-900 text-gray-100 p-4 min-h-screen flex flex-col gap-4">

<h1 class="text-xl font-bold text-center">Chore Checklist</h1>

<label class="block text-sm mb-1" for="date">Choose date</label>
<input id="date" type="date" class="w-full p-2 rounded text-gray-900" />

<!-- checklist placeholder -->
<div id="listArea" class="mt-4"></div>

<!-- tiny spinner -->
<div id="loading" class="flex items-center justify-center mt-4">
  <svg class="animate-spin h-6 w-6 text-emerald-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
  </svg>
  <span class="ml-2 text-sm text-gray-400">Loading choresâ€¦</span>
</div>

<button id="saveBtn" class="w-full bg-emerald-600 text-white py-2 rounded mt-4 disabled:opacity-40">
  Save &amp; Spin
</button>

<!-- results -->
<div id="resultArea" class="mt-6"></div>

<!-- roulette area -->
<div id="rouletteArea" class="hidden flex flex-col items-center gap-4">
  <div id="pointer"></div>
  <div id="wheel"></div>
  <button id="spinBtn" class="bg-amber-500 text-gray-900 px-4 py-2 rounded">Spin!</button>
</div>

<script>
/* â”€â”€ configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const ENDPOINT  = 'https://script.google.com/macros/s/AKfycby0mmIgX_IUcSCx5--Q9-4FnEDAsGWX05RUdzCzsqa1GnIvnUXKzprQpG05v-7xxngi/exec';           // <-- replace
const wheelConf = ['â‚±1','â‚±1','â‚±1','â‚±1','â‚±1','â‚±1','â‚±1','â‚±2','â‚±2','30 min watching'];

let choresCache = [];

/* â”€â”€ bootstrap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('DOMContentLoaded', async () => {
  await loadChores();
  document.getElementById('date').valueAsNumber = Date.now() - (new Date()).getTimezoneOffset()*60000;
  document.getElementById('date').addEventListener('change', renderChecklist);
  document.getElementById('saveBtn').addEventListener('click', saveData);
  setupWheel();
  renderChecklist();
});

/* â”€â”€ network ------------------------------------------------ */
async function loadChores(){
  const res  = await fetch(`${ENDPOINT}?action=chores`);
  const data = await res.json();
  choresCache = data.chores || [];
}
async function loadLog(date){
  const res = await fetch(`${ENDPOINT}?action=log&date=${date}`);
  return (await res.json()).rows || [];
}
async function postLog(date,list,reward){
  await fetch(ENDPOINT,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({date, list, reward})
  });
}

/* â”€â”€ ui helpers --------------------------------------------- */
async function renderChecklist(){
  /* show spinner */
  document.getElementById('loading').style.display='flex';
  document.getElementById('listArea').innerHTML='';
  const date   = document.getElementById('date').value;
  const rows   = await loadLog(date);
  const done   = new Set(rows.filter(r=>r[2]==='TRUE').map(r=>r[1]));
  const html = `<table class="w-full border border-gray-700 text-sm">
      <tbody>
        ${choresCache.map(c=>`
          <tr>
            <td class="p-2 border-b border-gray-700">${c}</td>
            <td class="p-2 border-b border-gray-700 text-center">
              <input type="checkbox" data-chore="${c}" ${done.has(c)?'checked':''}>
            </td>
          </tr>`).join('')}
      </tbody>
    </table>`;
  document.getElementById('listArea').innerHTML = html;
  /* hide spinner */
  document.getElementById('loading').style.display='none';
}

async function saveData(){
  const date  = document.getElementById('date').value;
  const list  = [...document.querySelectorAll('[data-chore]')].map(cb=>({chore:cb.dataset.chore, done:cb.checked}));
  const allDone = list.every(i=>i.done);
  const reward  = allDone ? spinWheel() : '';

  await postLog(date,list,reward);
  document.getElementById('resultArea').innerHTML =
    `<p class="text-lg font-semibold">Saved for ${date}.</p>` +
    (reward ? `<p class="text-xl mt-2">ðŸŽ‰ Reward: <span class="font-bold text-amber-400">${reward}</span></p>` :
               '<p>Keep going to earn todayâ€™s reward!</p>');

  if(reward) document.getElementById('rouletteArea').classList.add('hidden');
}

/* â”€â”€ roulette ------------------------------------------------ */
function setupWheel(){
  const wheel = document.getElementById('wheel');
  wheelConf.forEach((t,i)=>{
    const slice = document.createElement('div');
    slice.className='slice';
    slice.style.transform=`rotate(${i*36}deg) skewY(-54deg)`;
    slice.style.background = i%2? '#1e40af':'#2563eb';
    slice.innerHTML=`<span style="transform:rotate(54deg)">${t}</span>`;
    wheel.appendChild(slice);
  });
  document.getElementById('spinBtn').addEventListener('click',()=>spinWheel(true));
}
function spinWheel(show=false){
  const idx = Math.floor(Math.random()*10);
  if(show){
    const wheel=document.getElementById('wheel');
    const deg = 360*5 + idx*36 + 18;
    wheel.style.transition='transform 4s cubic-bezier(0.33,1,0.68,1)';
    wheel.style.transform=`rotate(${deg}deg)`;
  }
  return wheelConf[idx];
}

/* show/hide roulette button based on checkbox state */
document.addEventListener('change',()=>{
  const boxes=[...document.querySelectorAll('[data-chore]')];
  const allDone = boxes.length && boxes.every(b=>b.checked);
  document.getElementById('rouletteArea').classList.toggle('hidden',!allDone);
});
</script>
</body>
</html>
