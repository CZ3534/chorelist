<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kid Chore Tracker</title>

<!-- Poppins + Tailwind -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config={theme:{extend:{fontFamily:{sans:['Poppins','sans-serif']}}}};
</script>

<style>
/* slot-machine cabinet (same as previous) */
.slot-cabinet{width:260px;padding:20px;border-radius:20px;position:relative;
  border:6px solid #777;background:linear-gradient(145deg,#4b5563,#1f2937);
  box-shadow:inset 0 0 8px #000,0 8px 12px rgba(0,0,0,.6)}
.bulb-row{display:flex;gap:6px;justify-content:center;margin-bottom:16px}
.bulb{width:12px;height:12px;border-radius:50%;
  background:radial-gradient(#fde68a,#ca8a04 60%,#1f2937)}
#reelFrame{width:220px;height:72px;overflow:hidden;margin:auto;border-radius:12px;
  border:4px solid #111;box-shadow:inset 0 0 6px #000;background:#000}
#reel{display:flex;flex-direction:column}
.tile{height:72px;display:flex;align-items:center;justify-content:center;
  font-size:1.5rem;font-weight:600;color:#fff}
.tile:nth-child(odd){background:#0ea5e9}
.tile:nth-child(even){background:#22c55e}
.lever{position:absolute;right:-34px;top:50%;transform:translateY(-50%);
  width:18px;height:80px;background:linear-gradient(#9ca3af,#4b5563);
  border-radius:10px;border:3px solid #777}
.lever:after{content:'';position:absolute;bottom:-22px;left:50%;transform:translateX(-50%);
  width:30px;height:30px;border-radius:50%;background:#dc2626;border:4px solid #b91c1c;
  box-shadow:0 0 4px #000}
@media(max-width:420px){.slot-cabinet{transform:scale(.9)}}
</style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col items-center p-4">

<div class="w-full max-w-lg">
  <h1 class="text-2xl font-semibold text-center mb-4">Chore Checklist</h1>

  <!-- date row -->
  <div class="flex items-end gap-3 mb-4">
    <div class="flex-1">
      <label class="block text-sm font-medium mb-1" for="date">Choose date</label>
      <input id="date" type="date"
             class="w-full rounded-lg px-3 py-2 text-gray-900 shadow-inner">
    </div>
    <span id="dayBadge"
          class="bg-gray-700 text-sm px-4 h-10 flex items-center rounded-lg whitespace-nowrap"></span>
  </div>

  <!-- progress bar -->
  <div class="w-full h-3 bg-gray-700 rounded-full mb-4 overflow-hidden">
    <div id="progress" class="h-3 bg-emerald-500 transition-all w-0"></div>
  </div>

  <!-- chore list -->
  <div class="bg-gray-800 rounded-xl shadow-lg p-4 mb-6">
    <div id="loading" class="flex items-center justify-center">
      <svg class="animate-spin h-7 w-7 text-emerald-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
        <path class="opacity-75" fill="currentColor"
              d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"/>
      </svg>
      <span class="ml-3 text-base text-gray-400">Loading chores…</span>
    </div>
    <div id="listArea"></div>
  </div>

  <button id="saveBtn"
          class="w-full py-3 rounded-xl bg-emerald-600 hover:bg-emerald-500 transition disabled:opacity-40">
    Save
  </button>

  <div id="resultArea" class="text-center mt-4"></div>

  <!-- slot machine -->
  <div id="spinnerArea" class="hidden flex flex-col items-center mt-6">
    <div class="slot-cabinet">
      <div class="bulb-row">
        <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
        <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
      </div>
      <div id="reelFrame"><div id="reel"></div></div>
      <div class="lever"></div>
    </div>
  </div>
</div>

<script>
/* CONFIG */
const ENDPOINT='https://script.google.com/macros/s/AKfycby0mmIgX_IUcSCx5--Q9-4FnEDAsGWX05RUdzCzsqa1GnIvnUXKzprQpG05v-7xxngi/exec';
const baseRewards=['₱1','₱1','₱1','₱1','₱1','₱1','₱1','₱2','₱2','30 mins watch'];

let chores=[],reelArr=[],rewardDone=false;

/* helpers */
const shuffle=a=>a.sort(()=>Math.random()-0.5);
const wait=ms=>new Promise(r=>setTimeout(r,ms));

/* badge */
const todayISO=new Date().toISOString().split('T')[0];
document.getElementById('date').value=todayISO;
updateDayBadge(todayISO);
function updateDayBadge(iso){
  document.getElementById('dayBadge').textContent=
      new Date(iso).toLocaleDateStr
